<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>NYTimes Surveillance Articles (Infinite Scroll)</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        margin: 0;
        padding: 2rem;
      }
      h1 {
        text-align: center;
        margin-bottom: 1.5rem;
        font-weight: 400;
      }
      .articles {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 1.5rem;
      }
      .article {
        background: #222;
        border-radius: 10px;
        overflow: hidden;
        transition: transform 0.2s ease;
      }
      .article:hover {
        transform: scale(1.03);
      }
      .article img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        filter: grayscale(100%);
      }
      .article-content {
        padding: 1rem;
      }
      .article-content h2 {
        font-size: 1.1rem;
        margin: 0 0 0.5rem;
      }
      .article-content p {
        font-size: 0.9rem;
        color: #ccc;
      }
      .article-content a {
        display: inline-block;
        margin-top: 0.5rem;
        color: #1e90ff;
        text-decoration: none;
      }
      .article-content a:hover {
        text-decoration: underline;
      }
      .loading {
        text-align: center;
        margin-top: 2rem;
        color: #aaa;
      }
    </style>
  </head>
  <body>
    <h1>NYTimes Articles about Surveillance</h1>
    <div id="articles" class="articles"></div>
    <div id="loading" class="loading">Loading...</div>

    <script>
      const API_KEY = "JFjJBC7AGXwfjBKCCR0EnpNPntdKPoYr"; // Replace with your NYTimes API key
      let page = 0;
      let loading = false;
      let reachedEnd = false;

      async function fetchSurveillanceArticles() {
        if (loading || reachedEnd) return;
        loading = true;

        const loadingDiv = document.getElementById("loading");
        loadingDiv.textContent = "Loading...";

        const endpoint = `https://api.nytimes.com/svc/search/v2/articlesearch.json?q=surveillance&sort=newest&page=${page}&api-key=${API_KEY}`;
        const container = document.getElementById("articles");

        try {
          const res = await fetch(endpoint);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();

          const articles = data?.response?.docs || [];

          if (articles.length === 0) {
            reachedEnd = true;
            loadingDiv.textContent = "No more articles.";
            return;
          }

          // Render each article
          articles.forEach(a => {
            const title = a.headline?.main || "Untitled";
            const abstract = a.abstract || a.lead_paragraph || "";
            const url = a.web_url || "#";
            const img = a.multimedia?.length
              ? `https://www.nytimes.com/${a.multimedia[0].url}`
              : "";

            const div = document.createElement("div");
            div.className = "article";
            div.innerHTML = `
              ${img ? `<img src="${img}" alt="">` : ""}
              <div class="article-content">
                <h2>${title}</h2>
                <p>${abstract}</p>
                <a href="${url}" target="_blank">Read more â†’</a>
              </div>
            `;
            container.appendChild(div);
          });

          page++;
          loadingDiv.textContent = "Scroll for more...";
        } catch (err) {
          console.error("Error fetching articles:", err);
          loadingDiv.textContent = "Error loading articles.";
        } finally {
          loading = false;
        }
      }

      // Infinite scroll trigger
      window.addEventListener("scroll", () => {
        if (loading || reachedEnd) return;
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
          fetchSurveillanceArticles();
        }
      });

      // Initial load
      fetchSurveillanceArticles();
    </script>
  </body>
</html>
